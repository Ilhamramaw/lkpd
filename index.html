<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>LKPD Struktur Data: Queue</title>
    <link href="https://fonts.googleapis.com/css2?family=Nunito:wght@400;600;700;900&display=swap" rel="stylesheet">
    
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>

    <style>
        /* ===========================
           RESET & BASIC SETUP
        =========================== */
        body { background-color: #eef2f5; font-family: 'Nunito', sans-serif; margin: 0; padding: 20px; color: #333; display: flex; justify-content: center; }
        .page-container { width: 210mm; min-height: 297mm; background: white; box-shadow: 0 10px 25px rgba(0,0,0,0.1); padding: 40px; box-sizing: border-box; position: relative; }

        /* ===========================
           BOX STYLING
        =========================== */
        .section-card {
            background-color: #fff8e1; border: 2px solid #ffe082; border-radius: 15px; padding: 25px; margin-bottom: 30px; box-shadow: 0 4px 6px rgba(0,0,0,0.02);
            page-break-inside: avoid; 
        }
        .cover-box {
            background-color: #fff8e1; border: 5px solid #ffc107; border-radius: 25px; padding: 60px 40px; text-align: center; margin-bottom: 50px; box-shadow: 0 10px 20px rgba(255, 193, 7, 0.2);
        }
        .cover-box h1 { color: #007bff; font-size: 3.5rem; margin: 0 0 10px 0; font-weight: 900; text-transform: uppercase; letter-spacing: 2px; line-height: 1.2; }
        .cover-box h2 { color: #333; font-size: 1.8rem; margin-top: 0; font-weight: 700; opacity: 0.8; }
        .identity-box {
            background: rgba(255, 255, 255, 0.8); border: 3px solid #ffc107; border-radius: 15px; padding: 30px; margin-top: 40px; text-align: left; max-width: 85%; margin-left: auto; margin-right: auto; box-shadow: 0 4px 10px rgba(0,0,0,0.05);
        }
        .form-group { margin-bottom: 25px; }
        .form-group label { display: block; font-weight: 800; color: #007bff; margin-bottom: 8px; font-size: 1.1rem; }
        .paper-input { width: 100%; border: none; border-bottom: 2px dashed #aaa; background: transparent; font-family: 'Nunito', sans-serif; font-size: 1.3rem; color: #000; padding: 8px 0; outline: none; }
        .paper-input:focus { border-bottom: 3px solid #007bff; }

        /* ===========================
           CONTENT STYLING
        =========================== */
        .section-header { background-color: #007bff; color: white; padding: 10px 25px; border-radius: 50px; display: inline-block; font-weight: 800; margin-bottom: 20px; font-size: 1.2rem; box-shadow: 0 3px 6px rgba(0,0,0,0.2); }
        
        .answer-area {
            width: 100%; 
            border: 2px solid #bce0fd; 
            background-color: #fcfdff; 
            border-radius: 8px; 
            padding: 15px; 
            font-family: 'Nunito', sans-serif; 
            font-size: 1rem; 
            line-height: 1.6; 
            min-height: 80px; 
            box-sizing: border-box; 
            margin-bottom: 15px; 
            resize: none; 
            overflow-y: hidden; 
            white-space: pre-wrap; 
            word-wrap: break-word;
        }
        .answer-area:focus { border-color: #007bff; outline: none; background-color: #ffffff; }

        .learning-goals { border-left: 6px solid #007bff; background-color: #f9f9f9; padding: 20px; margin-bottom: 40px; border-radius: 0 10px 10px 0; }
        .learning-goals h3 { color: #007bff; margin-top: 0; font-size: 1.2rem; text-transform: uppercase; letter-spacing: 1px;}
        
        /* ===========================
           TABLE STYLING (FIXED BORDERS)
        =========================== */
        .simulation-table { 
            width: 100%; 
            border-collapse: collapse; 
            margin-top: 10px; 
            box-shadow: 0 2px 5px rgba(0,0,0,0.05); 
        }
        .simulation-table th { 
            background-color: #ffc107; 
            color: #333; 
            padding: 12px; 
            border: 1px solid #000 !important; /* Border Header Hitam */
            font-weight: 800; 
            text-align: center; 
        }
        .simulation-table td { 
            border: 1px solid #000 !important; /* Border Cell Hitam & Tegas */
            padding: 0; 
            height: 45px; 
            position: relative; 
            background-color: #ffffff; /* Cell Putih */
        }
        
        .table-input { 
            width: 100%; 
            height: 100%; 
            border: none; 
            text-align: center; 
            font-family: 'Nunito', sans-serif; 
            font-size: 1rem; 
            outline: none;
            /* KUNCI PERBAIKAN: Background Transparent agar garis td terlihat */
            background-color: transparent; 
        }
        
        
        .table-input.correct { 
            background-color: #d4edda !important; 
            color: #155724; 
            font-weight: bold; 
            /* Tambahkan border internal jika benar */
            box-shadow: inset 0 0 0 2px #28a745; 
        }
        .table-input.incorrect { 
            background-color: #f8d7da !important; 
            color: #721c24; 
            box-shadow: inset 0 0 0 2px #dc3545; 
        }
        
        .td-fixed { background-color: #f8f9fa; padding: 10px; text-align: center; font-weight: 600; color: #555; }
        .info-box { background-color: #fff3cd; border: 1px solid #ffeeba; color: #856404; padding: 15px; border-radius: 8px; display: flex; align-items: flex-start; gap: 15px; margin-bottom: 25px; text-align: justify; }
        .info-icon { font-size: 1.5rem; }
        .action-bar { display: flex; justify-content: center; gap: 15px; margin-top: 30px; padding-top: 20px; border-top: 2px dashed #ccc; }
        .btn { padding: 12px 25px; border-radius: 50px; font-size: 1rem; font-weight: bold; cursor: pointer; border: none; transition: transform 0.2s; display: flex; align-items: center; gap: 8px; }
        .btn:hover { transform: scale(1.05); }
        .btn-check { background-color: #28a745; color: white; box-shadow: 0 4px 10px rgba(40, 167, 69, 0.3); }
        .btn-save { background-color: #007bff; color: white; box-shadow: 0 4px 10px rgba(0, 123, 255, 0.3); }
        .btn-loading { background-color: #6c757d; cursor: not-allowed; color: white; }

    </style>
</head>
<body>

    <div id="lkpd-content" class="page-container">
        
        <div class="cover-box print-item">
            <h1>LKPD INFORMATIKA</h1>
            <h2>STRUKTUR DATA: QUEUE</h2>
            <div class="identity-box">
                <div class="form-group"><label>Nama Peserta Didik :</label><input type="text" class="paper-input" id="nama" placeholder="Isi nama lengkap..."></div>
                <div class="form-group"><label>Kelas :</label><input type="text" class="paper-input" id="kelas" placeholder="Isi kelas..." value="10"></div>
            </div>
        </div>

        <div class="learning-goals print-item">
            <h3>TUJUAN PEMBELAJARAN</h3>
            <ul style="margin: 0; padding-left: 20px;">
                <li>Mendefinisikan struktur data Queue melalui contoh kasus sederhana.</li>
                <li>Menjelaskan operasi dasar Queue melalui diskusi.</li>
                <li>Mensimulasikan struktur data Queue pada kasus nyata.</li>
            </ul>
        </div>

        <div class="section-card print-item">
            <div class="section-header">A. ANALISIS KONTEKS</div>
            <p><strong>1. Tuliskan apa yang kamu ketahui tentang antrian dalam kehidupan sehari-hari.</strong></p>
            <textarea class="answer-area" placeholder="Jawaban Anda..." oninput="autoResize(this)"></textarea>
            <p><strong>2. Menurutmu, apa yang terjadi jika antrian tidak mengikuti aturan siapa duluan?</strong></p>
            <textarea class="answer-area" placeholder="Jawaban Anda..." oninput="autoResize(this)"></textarea>
        </div>

        <div class="section-card print-item">
            <div class="section-header">B. IDENTIFIKASI MASALAH</div>
            <p><strong>1. Masalah apa yang muncul terkait pengelolaan antrian?</strong></p>
            <textarea class="answer-area" placeholder="Jawaban Anda..." oninput="autoResize(this)"></textarea>
            <p><strong>2. Bagaimana cara sistem komputer memastikan antrian berjalan teratur?</strong></p>
            <textarea class="answer-area" placeholder="Jawaban Anda..." oninput="autoResize(this)"></textarea>
        </div>

        <div class="info-box print-item">
            <div class="info-icon">üí°</div>
            <div><strong>Tahukah Kamu?</strong><br>Konsep Queue pertama kali digunakan di bidang telekomunikasi pada awal tahun 1900-an.</div>
        </div>

        <div class="section-card print-item">
            <div class="section-header">C. EKSPLORASI</div>
            <p><strong>1. Jelaskan konsep FIFO (First In First Out).</strong></p>
            <textarea class="answer-area" placeholder="Jawaban Anda..." oninput="autoResize(this)"></textarea>
            <p><strong>2. Sebutkan dan jelaskan dua operasi dasar Queue.</strong></p>
            <textarea class="answer-area" placeholder="Jawaban Anda..." oninput="autoResize(this)"></textarea>
            <p><strong>3. Untuk apa variabel front dan rear digunakan?</strong></p>
            <textarea class="answer-area" placeholder="Jawaban Anda..." oninput="autoResize(this)"></textarea>
        </div>

        <div class="section-card print-item">
            <div class="section-header">D. SIMULASI</div>
            <p>Isi tabel di bawah ini untuk mensimulasikan perubahan data.</p>
            <table class="simulation-table">
                <thead><tr><th width="10%">No</th><th width="25%">Operasi</th><th width="15%">Front</th><th width="15%">Rear</th><th width="35%">Isi Queue</th></tr></thead>
                <tbody>
                    <tr><td class="td-fixed">1</td><td class="td-fixed">enqueue(5)</td><td class="td-fixed">5</td><td class="td-fixed">5</td><td class="td-fixed">[5]</td></tr>
                    <tr><td class="td-fixed">2</td><td class="td-fixed">enqueue(7)</td><td><input type="text" placeholder="..." class="table-input" data-ans="5"></td><td><input type="text" placeholder="..." class="table-input" data-ans="7"></td><td><input type="text" class="table-input" placeholder="..." data-ans="5,7"></td></tr>
                    <tr><td class="td-fixed">3</td><td class="td-fixed">enqueue(9)</td><td><input type="text" placeholder="..." class="table-input" data-ans="5"></td><td><input type="text" placeholder="..." class="table-input" data-ans="9"></td><td><input type="text" class="table-input" placeholder="..." data-ans="5,7,9"></td></tr>
                    <tr><td class="td-fixed">4</td><td class="td-fixed">dequeue()</td><td><input type="text" placeholder="..." class="table-input" data-ans="7"></td><td><input type="text" placeholder="..." class="table-input" data-ans="9"></td><td><input type="text" class="table-input" placeholder="..." data-ans="7,9"></td></tr>
                    <tr><td class="td-fixed">5</td><td class="td-fixed">enqueue(4)</td><td><input type="text" placeholder="..." class="table-input" data-ans="7"></td><td><input type="text" placeholder="..." class="table-input" data-ans="4"></td><td><input type="text" class="table-input" placeholder="..." data-ans="7,9,4"></td></tr>
                    <tr><td class="td-fixed">6</td><td class="td-fixed">dequeue()</td><td><input type="text" placeholder="..." class="table-input" data-ans="9"></td><td><input type="text" placeholder="..." class="table-input" data-ans="4"></td><td><input type="text" class="table-input" placeholder="..." data-ans="9,4"></td></tr>
                    <tr><td class="td-fixed">7</td><td class="td-fixed">enqueue(8)</td><td><input type="text" placeholder="..." class="table-input" data-ans="9"></td><td><input type="text" placeholder="..." class="table-input" data-ans="8"></td><td><input type="text" class="table-input" placeholder="..." data-ans="9,4,8"></td></tr>
                </tbody>
            </table>
            <button class="btn btn-check" style="margin-top: 20px;" onclick="checkAnswers()" data-html2canvas-ignore="true">üîç Cek Jawaban</button>
        </div>

        <div class="section-card print-item">
            <div class="section-header">E. HASIL PENGAMATAN</div>
            <p><strong>1. Tuliskan output akhir program</strong></p><textarea class="answer-area" placeholder="Jawaban Anda..." rows="2" oninput="autoResize(this)"></textarea>
            <p><strong>2. Siapa yang keluar duluan?</strong></p><textarea class="answer-area" rows="2" placeholder="Jawaban Anda..." oninput="autoResize(this)"></textarea>
            <p><strong>3. Apakah urutan sesuai FIFO? Mengapa?</strong></p><textarea class="answer-area" placeholder="Jawaban Anda..." oninput="autoResize(this)"></textarea>
        </div>

        <div class="action-bar" data-html2canvas-ignore="true">
            <button id="btnDownload" class="btn btn-save" onclick="downloadPDFSmart()">üì• Unduh PDF</button>
        </div>

    </div>

    <script>
        function autoResize(element) { element.style.height = 'auto'; element.style.height = element.scrollHeight + 'px'; }
        function checkAnswers() {
            const inputs = document.querySelectorAll('.table-input');
            let allCorrect = true;
            inputs.forEach(input => {
                let userAnswer = input.value.trim().replace(/[\[\]\s]/g, '');
                let correctAnswer = input.getAttribute('data-ans').replace(/[\[\]\s]/g, '');
                if (userAnswer === correctAnswer && userAnswer !== '') { input.classList.remove('incorrect'); input.classList.add('correct'); }
                else { input.classList.remove('correct'); input.classList.add('incorrect'); allCorrect = false; }
            });
            allCorrect ? alert("üéâ Benar!") : alert("‚ö†Ô∏è Masih ada yang salah.");
        }

        async function downloadPDFSmart() {
            const nama = document.getElementById('nama').value;
            if (!nama) { alert('Isi nama dulu!'); return; }
            
            const btn = document.getElementById('btnDownload');
            const originalText = btn.innerHTML;
            btn.innerHTML = "‚è≥ Memproses...";
            btn.classList.add('btn-loading');

            const inputsAndTextareas = document.querySelectorAll('textarea, input.table-input');
            const replacements = []; 
            
            inputsAndTextareas.forEach(el => {
                const div = document.createElement('div');
                div.innerText = el.value;
                div.style.cssText = getComputedStyle(el).cssText;
                
                if (el.tagName === 'TEXTAREA') {
                    div.style.border = '2px solid #bce0fd'; 
                    div.style.backgroundColor = '#fcfdff';  
                    div.style.borderRadius = '8px';
                    div.style.padding = '15px';
                    div.style.whiteSpace = 'pre-wrap'; 
                } else if (el.tagName === 'INPUT') {
                    // FIX TABLE INPUT: Transparent agar border TD terlihat
                    div.style.backgroundColor = 'transparent'; 
                    div.style.display = 'flex';
                    div.style.alignItems = 'center';
                    div.style.justifyContent = 'center';
                }

                div.style.overflow = 'hidden';
                div.style.height = 'auto';
                div.style.minHeight = el.style.minHeight || 'auto';

                el.parentNode.replaceChild(div, el);
                replacements.push({ original: el, replacement: div });
            });

            const { jsPDF } = window.jspdf;
            const pdf = new jsPDF('p', 'mm', 'a4');
            const pageWidth = 210;
            const pageHeight = 297;
            const margin = 20; 
            const marginTop = 20; 
            const marginBottom = 20; 
            const contentWidth = pageWidth - (margin * 2);
            const contentHeight = pageHeight - marginTop - marginBottom; 
            
            let currentY = marginTop;

            const items = document.querySelectorAll('.print-item');

            for (let i = 0; i < items.length; i++) {
                const element = items[i];
                const canvas = await html2canvas(element, { scale: 2, useCORS: true, backgroundColor: null });
                const imgData = canvas.toDataURL('image/png');
                const imgHeight = (canvas.height * contentWidth) / canvas.width;

                const spaceLeft = pageHeight - marginBottom - currentY;

                const isSectionCard = element.classList.contains('section-card');

                if (isSectionCard && i > 0) {
                    pdf.addPage();
                    currentY = marginTop;
                } else if (imgHeight > spaceLeft) {
                    pdf.addPage();
                    currentY = marginTop;
                }

                if (imgHeight > contentHeight) {
                    let yOffset = 0;
                    while (yOffset < imgHeight) {
                        if (yOffset > 0) {
                            pdf.addPage();
                            currentY = marginTop; 
                        }
                        pdf.addImage(imgData, 'PNG', margin, currentY - yOffset, contentWidth, imgHeight);
                        
                        pdf.setFillColor(255, 255, 255);
                        pdf.rect(0, 0, pageWidth, marginTop, 'F'); 
                        pdf.rect(0, pageHeight - marginBottom, pageWidth, marginBottom, 'F'); 

                        yOffset += contentHeight;
                    }
                    currentY = marginTop + (imgHeight % contentHeight) + 5;
                } else {
                    pdf.addImage(imgData, 'PNG', margin, currentY, contentWidth, imgHeight);
                    currentY += imgHeight + 5;
                }
            }

            replacements.forEach(rep => {
                rep.replacement.parentNode.replaceChild(rep.original, rep.replacement);
            });

            const safeName = nama.replace(/[^a-z0-9]/gi, '_').substring(0, 20);
            pdf.save('LKPD-Queue-' + safeName + '.pdf');
            
            btn.innerHTML = originalText;
            btn.classList.remove('btn-loading');
        }
    </script>
</body>
</html>
